
START TRANSACTION; /* Transaction is used due to the destructive nature of these queries, if anything fails the transaction should abort, and the updates should be applied manually. */

CREATE TABLE `character_glyphs` (
  `guid` int(11) unsigned NOT NULL,
  `spec` tinyint(3) unsigned NOT NULL DEFAULT '0',
  `glyph1` int(11) unsigned NOT NULL DEFAULT '0',
  `glyph2` int(11) unsigned DEFAULT '0',
  `glyph3` int(11) unsigned DEFAULT '0',
  `glyph4` int(11) unsigned DEFAULT '0',
  `glyph5` int(11) unsigned DEFAULT '0',
  `glyph6` int(11) unsigned DEFAULT '0',
  PRIMARY KEY (`guid`,`spec`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `character_talent` (
  `guid` int(11) unsigned NOT NULL,
  `spell` int(11) unsigned NOT NULL,
  `spec` tinyint(3) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`guid`,`spell`,`spec`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

/* The below DELETE query should remove all known talents from `character_spell`,
   talents gathered by rockzOr of getmangos.com and updated/fixed by oc_redfox of trinitycore.org.
   This update should (probably) only be run once, on your characters database before enabling Dual Spec.. */
DELETE FROM `character_spell` WHERE `spell` IN (11078,18459,11069,11119,54747,11108,11100,11103,11366,11083,11095,11094,29074,31638,11115,11113,31641,11124,34293,11129,31679,64353,31656,44442,31661,44445,44449,44457,11071,11070,31670,11207,11189,29438,11175,11151,12472,11185,16757,11160,11170,11958,11190,31667,55091,11180,44745,11426,31674,31682,44543,44546,31687,44557,44566,44572,11210,11222,11237,28574,29441,11213,11247,11242,44397,54646,11252,11255,18462,29447,31569,12043,11232,31574,15058,31571,31579,12042,44394,44378,31584,31589,44404,44400,35578,44425,12282,16462,12286,12285,12300,12295,12290,12296,16493,12834,12163,56636,12700,12328,12284,12281,20504,12289,46854,29834,12294,46865,12862,64976,35446,46859,29723,29623,29836,46867,46924,12301,12298,12287,50685,12297,12975,12797,29598,12299,59088,12313,12308,12312,12809,12311,16538,29593,50720,29787,29140,46945,57499,20243,47294,46951,58872,46968,61216,12321,12320,12324,12322,12329,12323,16487,12318,23584,20502,12317,29590,12292,29888,20500,12319,46908,23881,29721,46910,29759,60970,29801,46913,56927,46917,13741,13732,13715,14165,13713,13705,13742,14251,13706,13754,13743,13712,18427,13709,13877,13960,30919,31124,31122,13750,31130,5952,35541,51672,32601,51682,51685,51690,14162,14144,14138,14156,51632,13733,14983,14168,14128,16513,14113,31208,14177,14174,31244,14186,14158,51625,58426,31380,51634,31234,31226,1329,51627,51664,51662,14179,13958,14057,30892,14076,13975,13981,14278,14171,13983,13976,14079,30894,14185,14082,16511,31221,30902,31211,14183,31228,31216,51692,51698,36554,58414,51708,51713,14522,47586,14523,14747,14749,14531,14521,14751,14748,33167,14520,14750,33201,18551,63574,33186,34908,45234,10060,63504,57470,47535,47507,47509,33206,47516,52795,47540,14913,14908,14889,27900,18530,19236,27811,14892,27789,14912,14909,14911,20711,14901,33150,14898,34753,724,33142,64127,33158,63730,63534,34861,47558,47562,47788,15270,15337,15259,15318,15275,15260,15392,15273,15407,15274,17322,15257,15487,15286,27839,33213,14910,63625,15473,33221,47569,33191,64044,34914,47580,47573,47585,16039,16035,16038,28996,30160,16040,16164,16089,16086,29062,28999,16041,30664,30672,16578,16166,51483,63370,51466,30675,51474,30706,51480,62097,51490,16182,16173,16184,29187,16179,16180,16181,55198,16176,16187,16194,29206,16188,30864,16178,30881,16190,51886,51554,30872,30867,51556,974,51560,51562,61295,16259,16043,17485,16258,16255,16262,16261,16266,43338,16254,16256,16252,29192,16268,51883,30802,29082,63373,30816,30798,17364,51525,60103,51521,30812,30823,51523,51528,51533,16934,16858,16947,16998,16929,17002,61336,16942,16966,16972,37116,48409,16940,49377,33872,57878,17003,33853,17007,34297,33851,57873,33859,48483,48492,33917,48532,48432,63503,50334,17050,17063,17056,17069,17118,16833,17106,16864,48411,24968,17111,17116,17104,17123,33879,17074,34151,18562,33881,33886,48496,48539,65139,48535,63410,51179,48438,16814,57810,16845,35363,16821,16836,16880,57865,16819,16909,16850,33589,5570,57849,33597,16896,33592,24858,48384,33600,48389,33603,48516,50516,33831,48488,48506,48505,17793,17788,18119,63349,17778,18126,17877,17959,18135,17917,17927,34935,17815,18130,30299,17954,17962,30293,18096,30288,54117,47258,30283,47220,47266,50796,18827,18174,17810,18179,18213,18182,17804,53754,17783,18288,18218,18094,32381,32385,63108,18223,54037,18271,47195,30060,18220,30054,32477,47198,30108,58435,47201,48181,18692,18694,18697,47230,18703,18705,18731,18754,19028,18708,30143,18769,18709,30326,18767,23785,47245,30319,47193,35691,30242,63156,54347,30146,63117,47236,59672,19552,19583,35029,19549,19609,24443,19559,53265,19616,19572,19598,19578,19577,19590,34453,19621,34455,19574,34462,53252,34466,53262,34692,53256,56314,53270,52783,19498,19159,19290,19184,19376,34494,19255,19503,19295,19286,56333,56342,56339,19370,19306,19168,34491,34500,19386,34497,34506,53295,53298,3674,53302,53290,53301,19407,53620,19426,34482,19421,19485,34950,19454,19434,34948,19464,19416,35100,23989,19461,34475,19507,53234,19506,35104,34485,53228,53215,34490,53221,53241,53209,20060,20101,25956,20335,20042,9452,20117,20375,26022,9799,32043,31866,20111,31869,20049,31871,53486,20066,31876,31879,53375,53379,35395,53501,53380,53385,20205,20224,20237,20257,9453,31821,20210,20234,20254,20244,53660,31822,20216,20359,31825,5923,31833,20473,31828,53551,31837,31842,53671,53569,53556,53563,63646,20262,31844,20174,20096,64205,20468,20143,53527,20487,20138,20911,20177,31848,20196,31785,20925,31850,20127,31858,53590,31935,53583,53709,53695,53595,48979,48997,49182,48978,49004,55107,48982,48987,49467,48985,49145,49015,48977,49006,49005,48988,53137,49027,49016,50365,62905,49018,55233,49189,55050,49023,61154,49028,49175,49455,49042,55061,49140,49226,50880,49039,51468,51123,49149,49137,49186,49471,49796,55610,49024,49188,50040,49203,50384,54639,51271,49200,49143,50187,49202,49184,51745,48962,55129,49036,48963,49588,48965,49013,51459,49158,49146,49219,55620,49194,49220,49223,49224,49208,52143,55666,51052,50391,63560,49032,49222,49217,51099,55090,50117,49206,61682,61685,61686,61689,53182,19596,53481,53175,61680,53178,53409,63900,53450,53427,53478,53477,53480,53476,62764,62758,61682,61684,23145,61686,61689,53180,53186,53182,19596,61680,53409,61685,52825,55709,53203,53427,53401,53426,53434,62759,62758,61682,61684,23145,61686,61689,19596,53483,53554,53514,53182,61680,53409,54044,53427,52234,53511,53508,53517,53490,53450,62758,53480,11080,18460,12338,11120,54749,12349,12353,12357,12351,12872,13043,29075,31639,11367,31642,12378,34295,31680,64357,31657,44443,44446,44469,12496,12473,31672,12672,28332,29439,12569,12952,12487,16758,12518,12982,12489,31668,55092,28592,54787,31675,31683,44545,44548,44560,44567,12592,12839,12463,54658,29444,12574,12606,12467,44398,12605,12598,18463,55339,31570,12500,31575,15059,31572,31582,44395,44379,31585,54486,44402,35581,12663,16463,12658,12697,12959,12676,12963,16494,12849,12711,56637,12781,12701,12812,20505,12668,46855,29838,46866,12330,35448,46860,29725,29859,56611,12818,12724,12665,50686,12750,12799,29599,12761,59089,12804,12810,12803,12958,16539,29594,29790,29143,46949,47295,46952,58874,61221,12835,12852,12876,12999,12950,16489,12857,23585,20503,13045,29591,29889,20501,12971,46909,29776,46911,29760,46914,56929,13793,13863,13848,14166,13853,13832,13872,13804,13867,13875,13788,18428,13800,13961,30920,31126,31123,31131,51679,35550,51674,58413,51686,14163,14148,14139,14160,51633,13865,14169,14132,16514,14114,31209,14175,31245,14190,14159,51626,31382,51635,31235,31227,51628,51665,58422,13970,14072,30893,14094,14062,14066,14172,14070,13979,14080,30895,14083,31222,30903,31212,31229,31217,51696,51700,58415,51709,14788,47587,14784,14770,14767,14774,14776,14768,33171,14780,14772,33202,18552,33190,34909,45243,63505,57472,47536,47508,47511,47517,52797,15012,15020,15008,27901,18531,27815,15362,27790,15013,15017,15018,15028,33154,15349,34859,33145,64129,33159,63733,63542,47559,47564,15335,15338,15307,15272,15317,15327,15448,15312,15311,17323,15331,27840,33214,33371,63626,33222,47570,33192,47581,47577,16109,16105,16160,28997,29179,16113,60184,16544,29064,29000,30665,30673,16579,51485,63372,51470,30678,51478,51481,62098,16226,16222,16209,29189,16214,16196,16230,16235,16205,16218,29205,30865,16210,30883,51555,30873,30868,51557,51561,51563,16295,16130,17486,16293,16302,16287,16290,29079,16271,16281,16306,29193,51884,30808,29084,63374,30818,51526,51522,30813,51524,51529,16935,16859,16948,16999,16930,24866,16943,16968,16974,37117,48410,16941,33873,57880,17004,33855,34300,33852,57876,33866,48484,48494,48489,48433,17051,17065,17058,17070,17119,16834,17107,48412,24969,17112,24943,17124,33880,17075,34152,33882,33887,48499,48544,48536,63411,51180,16815,57811,16846,35364,16822,16839,61345,16820,16910,16923,33590,57850,33599,16897,33596,48395,33601,48392,33604,48521,48514,48510,17796,17789,18120,63350,17779,18127,59738,18136,17918,17929,34938,17833,30301,17955,30295,18073,30289,54118,47259,47221,47267,18829,18175,17811,18180,18372,18183,17805,53759,17784,18219,18095,32382,32387,54038,18272,47196,30061,30057,32483,47199,47202,18693,18695,18698,47231,18704,18706,18743,18755,30144,18770,18710,18768,23822,47246,30320,35692,30245,63158,54348,63121,47237,19553,19584,35030,19550,19610,19575,19560,19617,19573,19599,20895,19592,34454,19622,34459,34464,53253,34467,53263,53259,56315,52785,19499,19160,19294,19387,63457,34496,19256,19297,19287,56336,56343,56340,19371,19180,34492,34502,34498,34507,53296,53299,53303,53291,19412,53621,19427,34483,19422,19487,34954,19455,34949,19465,19417,35102,19462,34476,19508,53237,35110,34486,53232,53216,53222,53243,20061,20102,25957,20336,20045,26016,20118,26023,25988,35396,31867,20112,20056,31872,53488,31877,31880,53376,53484,53502,53381,20206,20225,20238,20258,25836,20212,20235,20255,20245,53661,31823,20360,31826,5924,31835,31829,53552,31838,53673,53576,53557,63647,20263,31845,20175,20097,20469,20144,53530,20488,20139,20179,31849,20197,33776,31851,20130,31859,53591,53585,53710,53696,49483,49490,49500,49390,49508,55108,49477,50033,49488,49495,50154,49394,49526,49503,53138,49542,50371,62908,49529,50149,49533,61155,50031,50147,49786,55062,49661,50137,50884,51472,51127,50115,49657,51108,49790,49538,56822,50041,50385,54638,50151,50190,50127,51746,49567,55130,49562,49564,49589,49571,55236,51462,51267,49627,55623,49633,49599,49610,56834,55667,50392,49631,49654,51160,50118,61683,61687,61690,53183,53482,53176,61681,53179,53411,53451,53429,62765,62762,61683,61687,61690,53181,53187,53183,61681,53411,53204,53429,62760,62762,61683,61687,61690,53485,53555,53516,53183,61681,53411,53429,53497,53512,53451,62762,54734,12339,12846,12350,12358,12873,29076,31640,11368,12398,34296,31658,44448,44470,12497,16763,55094,15047,29440,12571,12953,12488,12519,12983,12490,31669,28593,31676,44549,44561,44568,12840,12464,54659,12575,12469,44399,18464,55340,12501,54354,15060,31583,44396,31586,54488,44403,12664,16464,12960,12677,12867,12712,56638,12783,12702,12813,23695,35449,29724,56612,12725,12666,50687,12751,12762,12811,16540,29792,29144,47296,46953,61222,12853,12877,13000,20496,16492,12858,23586,13046,29592,12972,56924,29761,46915,56930,13792,13849,13854,13843,13805,13789,18429,13801,13962,61329,35551,51687,14164,14140,14161,13866,14135,16515,14115,14176,14193,31383,51636,31236,58410,51629,51667,58423,13971,14063,14173,14071,13980,31223,30904,31213,31230,31218,51701,51710,14789,47588,14785,14771,14777,14769,33172,14781,18553,34910,45244,63506,47537,47515,52798,17191,15009,27902,18533,27816,15363,15014,15029,15354,34860,33146,33160,63737,63543,47560,47565,15336,15308,15320,15328,15313,15332,33215,63627,33223,33193,47582,47578,16110,16106,16161,28998,29180,16114,60185,29065,30666,30674,16580,51486,30679,51479,51482,62099,16227,16223,29191,16215,16198,16232,16240,16206,16219,29202,30866,16211,30884,30869,51558,51564,52456,17487,16303,51881,29080,16272,16282,16307,51885,30809,29086,30819,51527,30814,51530,16936,16860,16949,16931,16944,16975,57881,17005,33856,33957,57877,33867,48485,48495,48491,48434,17066,17059,17071,17120,16835,17108,24970,17113,24944,17076,34153,33883,33888,48500,48545,48537,51181,16816,57812,16847,16840,61346,16911,16924,33591,57851,33956,16899,48396,33602,48393,33605,48525,48511,17801,17790,63351,17780,59739,17930,34939,17834,30302,17956,30296,63245,30290,47260,47223,47268,18176,17812,17785,32383,32392,18273,47197,30062,32484,47200,47203,18696,18699,18707,18744,18756,30145,18771,23823,47247,30321,35693,30246,54349,63123,47238,19554,19585,19551,19612,19618,19600,19623,34460,34465,34468,53264,53260,56316,52786,19500,24283,19388,63458,19257,19298,56337,56344,56341,19373,19181,34493,34503,34499,34508,53297,53304,53292,53622,19429,34484,19423,19488,19456,19466,19418,24691,19509,53238,35111,34487,53217,53224,53244,20062,20103,20337,20119,35397,31868,20113,20057,31878,31881,53648,53503,53382,20207,20330,20239,20259,20213,20256,20361,5925,31836,31830,53553,31839,54151,63648,20264,53519,20098,20470,20145,20140,20181,20198,31852,20135,31860,53592,53711,49491,49501,49391,49509,49478,50034,49489,49497,55136,49395,50029,49504,49543,49530,50150,49534,61156,51456,49787,49662,50138,50885,51473,51128,51109,49791,59057,50043,54637,50152,50191,50128,49568,55131,49565,49572,55237,51463,49628,49635,49611,56835,55668,49632,49655,51161,50119,61688,53184,52858,53430,61688,53184,52858,53205,53430,61688,53184,52858,53430,12340,12847,12399,44471,16765,31677,44570,16769,12576,12502,31587,54489,16465,12784,12703,12814,56613,12726,12752,12763,16541,12855,12878,13001,12860,23587,13047,12973,29762,56931,13851,13844,13806,61330,13802,13963,35552,51688,14141,14136,14116,14194,51668,58424,30905,31219,51711,14790,52802,18554,52799,15010,27903,18534,15030,15355,33161,47566,15309,15314,33224,51166,16111,16107,16115,60187,16581,62100,16228,16224,16216,16220,16212,30885,51565,17488,16304,16283,16308,51531,16937,16861,17006,51268,17060,17072,24971,24945,17077,33889,51182,16817,57813,16912,33606,17802,17791,59740,17957,30291,47269,17813,32393,18274,30063,47204,18772,23824,30247,47239,19555,19586,19619,19601,19624,34469,56317,52787,19258,24296,34838,19430,19489,19419,34488,53245,20063,20104,20120,20209,20331,20260,20214,5926,31840,54154,63649,20265,20099,20146,20180,55225,49392,49479,61157,49788,49663,50886,51129,61433,50129,55132,51464,49636,55669,50120,12341,12848,12400,44472,16766,31678,44571,16770,12577,12503,31588,54490,16466,12785,12704,12815,56614,12727,12753,12764,16542,12856,12879,13002,12861,23588,13048,12974,29763,56932,13852,13845,13807,61331,13803,13964,35553,51689,14142,14137,14117,14195,51669,58425,30906,31220,51712,14791,52803,18555,52800,15011,27904,18535,15031,15356,33162,47567,15310,15316,33225,51167,16112,16108,16116,60188,16582,62101,16229,16225,16217,16221,16213,30886,51566,17489,16305,16284,16309,51532,16938,16862,24894,51269,17061,17073,24972,24946,17078,33890,51183,16818,57814,16913,33607,17803,17792,59741,17958,30292,47270,17814,32394,18275,30064,47205,18773,23825,30248,47240,19556,19587,19620,19602,19625,34470,56318,52788,19259,24297,34839,19431,19490,19420,34489,53246,20064,20105,20121,20208,20332,20261,20215,25829,31841,54155,63650,20266,20100,20147,20182,55226,49393,49480,61158,49789,49664,50887,51130,61434,50130,55133,51465,49638,55670,50121);ALTER TABLE `characters` ADD `speccount` tinyint(3) unsigned NOT NULL default 1 AFTER `arena_pending_points`;
ALTER TABLE `characters` ADD `activespec` tinyint(3) unsigned NOT NULL default 0 AFTER `speccount`;

ALTER TABLE `character_action` RENAME `character_action_old`;
CREATE TABLE `character_action` (
  `guid` int(11) unsigned NOT NULL default '0',
  `spec` tinyint(3) unsigned NOT NULL default '0',
  `button` tinyint(3) unsigned NOT NULL default '0',
  `action` int(11) unsigned NOT NULL default '0',
  `type` tinyint(3) unsigned NOT NULL default '0',
  PRIMARY KEY  (`guid`,`spec`,`button`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;
INSERT INTO `character_action` (`guid`,`button`,`action`,`type`) SELECT `guid`,`button`,`action`,`type` FROM `character_action_old`;
DROP TABLE `character_action_old`;

COMMIT;
